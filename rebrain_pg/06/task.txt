1. На обоих серверах установить postgresql 13 через пакетный менеджер.
2. Настроить потоковую репликацию между master и slave в синхронном режиме:
- Задать hostname серверов master и slave соответственно;
- Репликация осуществляется под пользователем postgres с ssh аутентификацией по ключу;
- Разрешить безусловную аутентификацию клиентов в файле pg_hba.conf для пользователя репликации (postgres) с подключением для любых адресов (0.0.0.0/0);
- В файле postgresql.conf разрешить все имеющиеся IP-интерфейсы;
- Вынести логи (master, slave) в файл postgresql.log по пути /var/log/;
- Сконфигурировать на slave postgresql.auto.conf с указанием мастер ноды (с этим Вам поможет pg_basebackup);
- Перезапустить postgres.
3. Удостоверится в работе реплики.
4. На мастере восстановить schema.sql и data.sql из каталога /opt.
5. Убедиться, что схема бд и данные перенеслись на slave.
6. Если уверены, что все сделали правильно, отправляйте задание на проверку.
